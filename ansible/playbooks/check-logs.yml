---
- name: Check logs of all containers
  hosts: all
  become: yes
  gather_facts: no

  tasks:
    - name: Get list of running containers
      ansible.builtin.command: docker ps --format "{{ '{{' }}.Names{{ '}}' }}"
      register: running_containers
      changed_when: false

    - name: Display running containers
      ansible.builtin.debug:
        msg: "Running containers on {{ inventory_hostname }}: {{ running_containers.stdout_lines }}"

    - name: Get logs for each container
      ansible.builtin.shell: |
        for container in $(docker ps --format "{{ '{{' }}.Names{{ '}}' }}"); do
          echo "=== Logs for $container ==="
          docker logs --tail 30 "$container" 2>&1
          echo ""
        done
      register: all_logs
      changed_when: false

    - name: Display logs
      ansible.builtin.debug:
        msg: "{{ all_logs.stdout_lines }}"
